<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="spuriousimportance">
<title>Correlated predictors disrupt importance • spuriousimportance</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Correlated predictors disrupt importance">
<meta property="og:description" content="spuriousimportance">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">spuriousimportance</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9002</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/correlation.html">Correlated predictors disrupt importance</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Correlated predictors disrupt importance</h1>
            
      
      
      <div class="d-none name"><code>correlation.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/" class="external-link">randomForest</a></span><span class="op">)</span>
<span class="co">#&gt; randomForest 4.6-14</span>
<span class="co">#&gt; Type rfNews() to see new features/changes/bug fixes.</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'ggplot2'</span>
<span class="co">#&gt; The following object is masked from 'package:randomForest':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     margin</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: lattice</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">spuriousimportance</span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="overview-of-our-example-dataset">Overview of our example dataset<a class="anchor" aria-label="anchor" href="#overview-of-our-example-dataset"></a>
</h2>
<p>Let’s start with generating a dataset named <code>ds</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">17</span><span class="op">)</span>
<span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_dataset.html">generate_dataset</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Among five predictor variables <code>v</code>, <code>w</code>, <code>x</code>, <code>y</code>, and <code>z</code> in the dataset, the first two are the most important for the regression of a response variable <code>r</code>, as the following correlation matrix shows.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">r</span> <span class="op">~</span> <span class="va">v</span> <span class="op">+</span> <span class="va">w</span> <span class="op">+</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">ds</span><span class="op">)</span></code></pre></div>
<p><img src="correlation_files/figure-html/cm-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="training-a-model-that-works-as-expected">Training a model that works as expected<a class="anchor" aria-label="anchor" href="#training-a-model-that-works-as-expected"></a>
</h2>
<p>First, we train a random forest for the regression of <code>r</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">randomForest</a></span><span class="op">(</span><span class="va">r</span> <span class="op">~</span> <span class="va">v</span> <span class="op">+</span> <span class="va">w</span> <span class="op">+</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">ds</span>, mtry <span class="op">=</span> <span class="fl">2</span>, ntree <span class="op">=</span> <span class="fl">50</span>, importance <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>The following code illustrates how well the trained model performs the regression for a new dataset. Its accuracy turns out to be satisfactory although we omit to present any measurement of the accuracy.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">validate_regression</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rf</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">newds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_dataset.html">generate_dataset</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">newres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rf</span>, newdata <span class="op">=</span> <span class="va">newds</span><span class="op">)</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">newds</span><span class="op">$</span><span class="va">r</span>, y <span class="op">=</span> <span class="va">newres</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span>, colour <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"r"</span><span class="op">)</span> <span class="op">+</span>
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">validate_regression</span><span class="op">(</span><span class="va">rf</span><span class="op">)</span></code></pre></div>
<p><img src="correlation_files/figure-html/valid-1.png" width="672"></p>
<p><code><a href="https://rdrr.io/pkg/randomForest/man/importance.html" class="external-link">randomForest::importance()</a></code> extracts the importance matrix of predictors from a given random forest. Note that the function can calculate different measures of importance, depending on argument <code>type</code>. Calling it with <code>type = 1</code> returns a permutation importance using the mean squared error (MSE) for each tree.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/importance.html" class="external-link">importance</a></span><span class="op">(</span><span class="va">rf</span>, type <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt;      %IncMSE</span>
<span class="co">#&gt; v 11.0877780</span>
<span class="co">#&gt; w  9.1825884</span>
<span class="co">#&gt; x 11.7523414</span>
<span class="co">#&gt; y  0.8433381</span>
<span class="co">#&gt; z -0.8506021</span></code></pre></div>
<p>By default the permutation importance is normalized to be so-called a z-score. On the other hand, if another parameter <code>scale = FALSE</code> is passed, we get a raw (unscaled) importance as follows.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/importance.html" class="external-link">importance</a></span><span class="op">(</span><span class="va">rf</span>, type <span class="op">=</span> <span class="fl">1</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt;        %IncMSE</span>
<span class="co">#&gt; v  0.979730519</span>
<span class="co">#&gt; w  0.730911604</span>
<span class="co">#&gt; x  0.049559999</span>
<span class="co">#&gt; y  0.002118336</span>
<span class="co">#&gt; z -0.001899118</span></code></pre></div>
<p>Calling the function with <code>type = 2</code> returns another type of importance defined with a mean decrease in node impurity, which is measured by the residual sum of squares (RSS) for regressors.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/importance.html" class="external-link">importance</a></span><span class="op">(</span><span class="va">rf</span>, type <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt;   IncNodePurity</span>
<span class="co">#&gt; v    307.818564</span>
<span class="co">#&gt; w    229.955117</span>
<span class="co">#&gt; x     22.125648</span>
<span class="co">#&gt; y      4.711215</span>
<span class="co">#&gt; z      7.412531</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="for-a-regression-with-a-reduced-set-of-predictors">For a regression with a reduced set of predictors<a class="anchor" aria-label="anchor" href="#for-a-regression-with-a-reduced-set-of-predictors"></a>
</h2>
<p>Here we will see what happens when excluding unimportant variables <code>y</code> and <code>z</code> from the set of predictors.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ds1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_dataset.html">generate_dataset</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">rf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">randomForest</a></span><span class="op">(</span><span class="va">r</span> <span class="op">~</span> <span class="va">v</span> <span class="op">+</span> <span class="va">w</span> <span class="op">+</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">ds1</span>, mtry <span class="op">=</span> <span class="fl">2</span>, ntree <span class="op">=</span> <span class="fl">50</span>, importance <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">validate_regression</span><span class="op">(</span><span class="va">rf1</span><span class="op">)</span></code></pre></div>
<p><img src="correlation_files/figure-html/rf1-1.png" width="672"></p>
<p>Now the resulting importance of <code>x</code>, computed by permutating OOB data, is higher than that of <code>v</code> or <code>w</code> as follows.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/importance.html" class="external-link">importance</a></span><span class="op">(</span><span class="va">rf1</span>, type <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt;     %IncMSE</span>
<span class="co">#&gt; v 10.720305</span>
<span class="co">#&gt; w  8.567586</span>
<span class="co">#&gt; x 52.922063</span></code></pre></div>
<p>Nevertheless the unscaled permutation importance does not suffer the bias.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/importance.html" class="external-link">importance</a></span><span class="op">(</span><span class="va">rf1</span>, type <span class="op">=</span> <span class="fl">1</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt;      %IncMSE</span>
<span class="co">#&gt; v 0.84916419</span>
<span class="co">#&gt; w 0.62726654</span>
<span class="co">#&gt; x 0.05182589</span></code></pre></div>
<p>The importance measured by the node impurity is also as expected.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/importance.html" class="external-link">importance</a></span><span class="op">(</span><span class="va">rf1</span>, type <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt;   IncNodePurity</span>
<span class="co">#&gt; v      282.9347</span>
<span class="co">#&gt; w      215.9355</span>
<span class="co">#&gt; x       12.4550</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="for-a-binary-classification-defined-by-ranks">For a binary classification defined by ranks<a class="anchor" aria-label="anchor" href="#for-a-binary-classification-defined-by-ranks"></a>
</h2>
<p>Next, we will train a random forest for the binary classification of a response variable <code>s</code>, which divides the rows of a generated dataset into two groups, “A” and “B”, of equal numbers, using <code>r</code>’s median as a cut-off.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ds2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_dataset.html">generate_dataset</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">rf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">randomForest</a></span><span class="op">(</span><span class="va">s</span> <span class="op">~</span> <span class="va">v</span> <span class="op">+</span> <span class="va">w</span> <span class="op">+</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">ds2</span>, mtry <span class="op">=</span> <span class="fl">2</span>, ntree <span class="op">=</span> <span class="fl">50</span>, importance <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>The classification performed by the obtained model is of high accuracy, as follows.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">validate_classification</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rf</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">newds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_dataset.html">generate_dataset</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">newres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rf</span>, newdata <span class="op">=</span> <span class="va">newds</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html" class="external-link">confusionMatrix</a></span><span class="op">(</span><span class="va">newres</span>, <span class="va">newds</span><span class="op">$</span><span class="va">s</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">validate_classification</span><span class="op">(</span><span class="va">rf2</span><span class="op">)</span>
<span class="co">#&gt; Confusion Matrix and Statistics</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Reference</span>
<span class="co">#&gt; Prediction   A   B</span>
<span class="co">#&gt;          A 246   5</span>
<span class="co">#&gt;          B   4 245</span>
<span class="co">#&gt;                                           </span>
<span class="co">#&gt;                Accuracy : 0.982           </span>
<span class="co">#&gt;                  95% CI : (0.9661, 0.9917)</span>
<span class="co">#&gt;     No Information Rate : 0.5             </span>
<span class="co">#&gt;     P-Value [Acc &gt; NIR] : &lt;2e-16          </span>
<span class="co">#&gt;                                           </span>
<span class="co">#&gt;                   Kappa : 0.964           </span>
<span class="co">#&gt;                                           </span>
<span class="co">#&gt;  Mcnemar's Test P-Value : 1               </span>
<span class="co">#&gt;                                           </span>
<span class="co">#&gt;             Sensitivity : 0.9840          </span>
<span class="co">#&gt;             Specificity : 0.9800          </span>
<span class="co">#&gt;          Pos Pred Value : 0.9801          </span>
<span class="co">#&gt;          Neg Pred Value : 0.9839          </span>
<span class="co">#&gt;              Prevalence : 0.5000          </span>
<span class="co">#&gt;          Detection Rate : 0.4920          </span>
<span class="co">#&gt;    Detection Prevalence : 0.5020          </span>
<span class="co">#&gt;       Balanced Accuracy : 0.9820          </span>
<span class="co">#&gt;                                           </span>
<span class="co">#&gt;        'Positive' Class : A               </span>
<span class="co">#&gt; </span></code></pre></div>
<p>However <code>x</code>’s importance, computed from permutating OOB data, is higher than <code>v</code>’s or <code>w</code>’s, again.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/importance.html" class="external-link">importance</a></span><span class="op">(</span><span class="va">rf2</span>, type <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt;   MeanDecreaseAccuracy</span>
<span class="co">#&gt; v            11.146407</span>
<span class="co">#&gt; w            11.432070</span>
<span class="co">#&gt; x            16.785657</span>
<span class="co">#&gt; y             1.407842</span>
<span class="co">#&gt; z             1.534501</span></code></pre></div>
<p>Yet, such reversal does not occur with the raw permutation importance</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/importance.html" class="external-link">importance</a></span><span class="op">(</span><span class="va">rf2</span>, type <span class="op">=</span> <span class="fl">1</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt;   MeanDecreaseAccuracy</span>
<span class="co">#&gt; v          0.214378239</span>
<span class="co">#&gt; w          0.233186183</span>
<span class="co">#&gt; x          0.054300801</span>
<span class="co">#&gt; y          0.002153339</span>
<span class="co">#&gt; z          0.001762533</span></code></pre></div>
<p>… nor with the one measured by the node impurity.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/importance.html" class="external-link">importance</a></span><span class="op">(</span><span class="va">rf2</span>, type <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt;   MeanDecreaseGini</span>
<span class="co">#&gt; v       111.562181</span>
<span class="co">#&gt; w       100.786000</span>
<span class="co">#&gt; x        27.847465</span>
<span class="co">#&gt; y         5.458803</span>
<span class="co">#&gt; z         3.892912</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The core of our trick to disrupt importance in this vignette is to include two correlated predictors, <code>v</code> and <code>w</code>. They are collinear in fact. For your information, [1] explains the same issue of collinearity in predictors, as well as how to deal with it.</p>
<p>Our examples show that high accuracy of the regression or classification performed by a trained model does not imply that the resulting importance is correct. They also indicate that the unscaled permutation importance behaves more preferably than the scaled does, which agrees with the statements found in [2] and [3].</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>[1] scikit-learn developers. Permutation Importance with Multicollinear or Correlated Features. <a href="https://scikit-learn.org/stable/auto_examples/inspection/plot_permutation_importance_multicollinear.html" class="external-link uri">https://scikit-learn.org/stable/auto_examples/inspection/plot_permutation_importance_multicollinear.html</a></p>
<p>[2] Strobl, C., Boulesteix, AL., Kneib, T. et al. Conditional variable importance for random forests. BMC Bioinformatics 9, 307 (2008). <a href="https://doi.org/10.1186/1471-2105-9-307" class="external-link uri">https://doi.org/10.1186/1471-2105-9-307</a></p>
<p>[3] Parr, T. et al. Beware Default Random Forest Importances. <a href="https://explained.ai/rf-importance/index.html" class="external-link uri">https://explained.ai/rf-importance/index.html</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Takeshi Abe.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
